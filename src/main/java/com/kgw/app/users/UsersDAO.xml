<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.kgw.app.users.UsersDAO">
    	<!-- 회원가입 -->
    	<insert id="register" parameterType="UsersDTO" useGeneratedKeys="true" keyProperty="username">
    		INSERT INTO users (username, password, name, email, phone, birth)
			VALUES ( #{username}, #{password}, #{name}, #{email}, #{phone}, #{birth} )
    	</insert>
    	
    	<select id="detail" resultMap="detailResult" resultType="UsersDTO">
    		select * from users u
				left join profile p
				on u.username = p.username
			where u.username = #{username}
    	</select>
    	
    	<resultMap type="UsersDTO" id="detailResult">
    		<id column="username" property="username"/>
    		<result column="password" property="password"/>
    		<result column="name" property="name"/>
    		<result column="email" property="email"/>
    		<result column="phone" property="phone"/>
    		<result column="birth" property="birth"/>
    		
    		<association property="usersFileDTO" javaType="UsersFileDTO">
    			<id column="file_num" property="fileNum"/>
    			<result column="file_name" property="fileName"/>
    			<result column="file_origin" property="fileOrigin"/>
    		</association>
    	</resultMap>
    	
    	
    	
    	<!-- 프로필 사진 업로드 -->
   		<insert id="userFileAdd" parameterType="UsersFileDTO">
    		INSERT INTO profile (file_name, file_origin, username)
    		VALUES (#{fileName}, #{fileOrigin}, #{username})
    	</insert>
    	
    	
    	
    	
    	
    </mapper>